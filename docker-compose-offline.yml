version: '3.8'

# 离线部署配置 - 假设本地已有所需镜像
# 使用时请确保已经通过其他方式获取并加载了所需镜像

services:
  # 最小化的shadowsocks服务配置
  shadowsocks:
    # 假设本地已有shadowsocks-libev镜像
    image: teddysun/shadowsocks-libev:latest
    container_name: shadowsocks
    restart: unless-stopped
    ports:
      - "8388:8388/tcp"
      - "8388:8388/udp"
    environment:
      - PASSWORD=${PASSWORD:?必须设置PASSWORD环境变量}
      - METHOD=aes-256-gcm
    healthcheck:
      test: ["CMD", "sh", "-c", "nc -z 0.0.0.0 8388"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
    volumes:
      - ./logs:/var/log/shadowsocks

volumes:
  logs: